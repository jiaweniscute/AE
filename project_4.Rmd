---
title: "project_4"
author: "Ng Jia Wen"
date: "7 August 2017"
output: html_document
---
```{r}
setwd("~/School/Analytical Edge/Project")
library(mlogit) 
library(ModelMetrics)
library(glmnet)
library(caret)

safety<- read.csv('train.csv')
```
### Preprocessing
```{r}
training <- subset(safety, Task <=12)
testing <- subset(safety, Task >12)

preProcValues <- preProcess(training[,!(colnames(training) %in% c("Ch1","Ch2","Ch3","Ch4")), drop=FALSE])

training <- model.matrix(Choice~.,data = training)
testing <- model.matrix(Choice~.,data = test)

trainTransformed <- predict(preProcValues, training)
testTransformed <- predict(preProcValues, testing)

```

```{r}

train <-  mlogit.data(subset(safety,Task<=12),
                  shape ='wide',
                  choice = 'Choice',
                  sep = '',
                  varying = c(4:83), 
                  alt.levels = c("Ch1","Ch2","Ch3","Ch4"),id.var = 'Case')

test <-  mlogit.data(subset(safety,Task > 12),
                  shape ='wide',
                  choice = 'Choice',
                  sep = '',
                  varying = c(4:83), 
                  alt.levels = c("Ch1","Ch2","Ch3","Ch4"),
                  id.var = 'Case') 

ActualChoice <- subset(safety, Task > 12)[,"Choice"]


mixedlogitmodel2 <-  mlogit(Choice ~ 1|segment+year+miles+night+gender+age+educ+region+Urb+income+ppark,data = train,panel = TRUE, rpar = c(Price = 'n') )
mixedlogitpred2 <- predict(mixedlogitmodel2,newdata = test,probability = TRUE)

mixedlogit_mll_test <-mlogLoss(ActualChoice,mixedlogitpred2)

```
```

```{r}

mlogloss <- function(data, lev = NULL, model = NULL) {
  logloss_val <- logLoss(y_pred = data$pred, y_true = data$Choice, positive = lev[1])
  c(mlogloss = logloss_val)
}

control <- trainControl(method ='cv',savePredictions = T, classProbs = T, summaryFunction = mlogloss)


## Random Forest
set.seed(1)
fit.rf <- train(Choice~.-Case-No-Task-Ch1-Ch2-Ch3-Ch4, data=safety, method="rf", trControl=control)

## SVM
set.seed(1)
fit.svm <- train(Choice~.-Case-No-Task-Ch1-Ch2-Ch3-Ch4, data=safety, method="svmRadial", trControl=control)


```